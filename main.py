import streamlit as st
from pathlib import Path
import re

# Z√°kladn√≠ nastaven√≠ str√°nky
st.set_page_config(
    page_title="Quality Tools",
    page_icon="üß∞",
    layout="wide",
)

st.title("üß∞ Basic quality tools")
st.write("Chose tool in folder `pages/`.")

# -------------------------------------------------
# Funkce: hezƒç√≠ n√°zev z n√°zvu souboru
# -------------------------------------------------
def pretty_name_from_filename(fname: str) -> str:
    """
    P≈ôevede nap≈ô. '1_Process_capability.py' -> 'Process capability'
    """
    stem = Path(fname).stem  # bez p≈ô√≠pony
    # odstra≈à p≈ô√≠padn√© ƒç√≠seln√© prefixy typu '1_' '01_'
    stem = re.sub(r"^\d+[_-]*", "", stem)
    # nahradit podtr≈æ√≠tka mezerami
    stem = stem.replace("_", " ").replace("-", " ")
    # prvn√≠ p√≠smeno velk√©
    return stem.strip().capitalize()


# -------------------------------------------------
# Naƒçten√≠ str√°nek z adres√°≈ôe pages
# -------------------------------------------------
BASE_DIR = Path(__file__).parent
PAGES_DIR = BASE_DIR / "pages"

if not PAGES_DIR.exists():
    st.error("Adres√°≈ô `pages/` neexistuje. Ujisti se, ≈æe struktura projektu je spr√°vn√°.")
    st.stop()

page_files = sorted(PAGES_DIR.glob("*.py"))

if not page_files:
    st.warning("V adres√°≈ôi `pages/` nejsou ≈æ√°dn√© *.py soubory.")
    st.stop()

# -------------------------------------------------
# Konfigurace dla≈ædic (voliteln√© ‚Äì m≈Ø≈æe≈° si doplnit popisy/ikony ruƒçnƒõ)
# -------------------------------------------------
# Mapa: pattern ve jm√©nu souboru -> (ikona, popis)
ICON_MAP = {
    "capab": ("üìà", "Process capability evaluation (Cp, Cpk, Pp, Ppk)."),
    "measurement_system_analyze": ("üìè", "Measurement system analyze (MSA) - Type1, Type2, Type3 and Attributive."),
    "pareto": ("üìä", "Pareto anal√Ωza probl√©m≈Ø."),
    "fishbone": ("üêü", "Ishikawa diagram p≈ô√≠ƒçin a n√°sledk≈Ø."),
}

def guess_icon_and_desc(filepath: Path):
    name_lower = filepath.stem.lower()
    for key, (icon, desc) in ICON_MAP.items():
        if key in name_lower:
            return icon, desc
    # default
    return "üß©", "N√°stroj kvality."

# -------------------------------------------------
# Vykreslen√≠ dla≈ædic ‚Äì m≈ô√≠≈æka 3 sloupc≈Ø
# -------------------------------------------------
NUM_COLS = 3
cols = st.columns(NUM_COLS)

for i, page_path in enumerate(page_files):
    col = cols[i % NUM_COLS]
    with col:
        icon, desc = guess_icon_and_desc(page_path)
        nice_name = pretty_name_from_filename(page_path.name)

        # "Obr√°zek" / head dla≈ædice
        tile = st.container(border=True)
        with tile:
            st.markdown(f"### {icon} {nice_name}")
            st.caption(desc)

            # Odkaz na str√°nku v multipage appce
            # cesta je relativn√≠ k main.py ‚Üí "pages/xyz.py"
            st.page_link(
                f"pages/{page_path.name}",
                label="Open tool",
                icon="‚û°Ô∏è",
                use_container_width=True,
            )

st.write("---")
st.caption(
    "Tip: Tools are in left sidebar. "
    "Mane page shows overview of the tools."
)

st.markdown("---")
st.markdown(
    """
    ### Disclaimer

    The results generated by this application are based solely on the data provided by the user.  
    The author of this application assumes no responsibility for the accuracy, completeness,  
    or interpretation of the data or the resulting analysis. The output should not be considered  
    financial, technical, or professional advice. Users are fully responsible for verifying  
    all results and for any decisions made based on this analysis. Use this tool at your own risk.
    """,
    help="Legal disclaimer"
)

